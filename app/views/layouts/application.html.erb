<!DOCTYPE html>
<html>
  <head>
    <title>Default</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <script src="https://kit.fontawesome.com/934169f86d.js" crossorigin="anonymous"></script>

    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.css">

    <!-- Bootstrap JavaScript Bundle CDN (includes Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>

  </head>

  <body data-flash-notice="<%= flash[:notice] %>" data-flash-alert="<%= flash[:alert] %>">
<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Navbar</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ms-auto me-5">
        <% if admin_signed_in? %>
          <li class="nav-item">
            <%= link_to 'ユーザー一覧', admin_users_path, class: 'btn btn-dark' %>
          </li>
          <li class="nav-item">
            <%= link_to 'ログアウト', destroy_admin_session_path, method: :get, class: 'btn btn-dark' %>
          </li>
          <li class="nav-item">
            <%= link_to 'ユーザー画像一覧', admin_users_path, class: 'btn btn-dark' %>
          </li>
          <li class="nav-item">
            <%= link_to 'ユーザー画像登録', admin_users_path, class: 'btn btn-dark' %>
          </li>

        <% elsif user_signed_in? %>
          <li class="nav-item">
            <%= link_to 'マイページ', user_path(current_user.id), class: 'btn btn-dark' %>
          </li>

<li class="nav-item">
  <% if current_user.owned_groups.any? %>
    <% owned_group = current_user.owned_groups.first %>
    <%= link_to 'グループ編集', edit_group_path(owned_group), class: 'btn btn-dark' %>
    <%= link_to 'グループ詳細', group_path(owned_group), class: 'btn btn-dark' %>
  <% elsif current_user.groups.any? %>
    <% joined_group = current_user.groups.first %>
    <%= link_to '募集を探す', groups_path, class: 'btn btn-dark' %>
    <%= link_to '参加中のグループ', group_path(joined_group), class: 'btn btn-dark' %>
  <% else %>
    <%= link_to '募集を探す', groups_path, class: 'btn btn-dark' %>
    <%= link_to '募集する', new_group_path, class: 'btn btn-dark' %>
  <% end %>
</li>


          <li class="nav-item">
            <%= link_to 'ログアウト', destroy_user_session_path, method: :get, class: 'btn btn-dark' %>
          </li>

        <% else %>
          <li class="nav-item">
            <%= link_to '新規登録', new_user_registration_path, class: 'btn btn-dark' %>
          </li>
          <li class="nav-item">
            <%= link_to 'ログイン', new_user_session_path, class: 'btn btn-dark' %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
<% if user_signed_in? %>
  <div class="dropdown me-5">
    <button class="btn btn-link dropdown-toggle" type="button" id="notification-icon" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="fas fa-bell"></i>
      <% unread_notifications_count = current_user.notifications.where(read: false).count %>
      <% if unread_notifications_count.positive? %>
        <span class="badge bg-danger" id="unread-count"><%= unread_notifications_count %></span>
      <% end %>
    </button>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notification-icon">
      <% if current_user.notifications.empty? %>
        <li>
          <a class="dropdown-item" href="#">
            <div class="text-muted">
              通知はありません
            </div>
          </a>
        </li>
      <% else %>
        <% current_user.notifications.last(5).reverse.each do |notification| %>
          <li>
            <a class="dropdown-item" href="#">
              <div class="text-muted small">
                <%= time_ago_in_words(notification.created_at) %>前
              </div>
              <%= notification.content %>
            </a>
            <% unless notification == current_user.notifications.last %>
              <hr class="dropdown-divider">
            <% end %>
          </li>
        <% end %>
      <% end %>
    </ul>
  </div>
<% end %>

</nav>


    <%= yield %>
  </body>
</html>
